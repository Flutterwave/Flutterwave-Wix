{"version":3,"file":"metro-runtime.umd.js","mappings":"AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,CAAC;AACD,O;;UCVA;UACA;;;;;WCDA;WACA;WACA;WACA;WACA,yCAAyC,wCAAwC;WACjF;WACA;WACA;;;;;WCPA;;;;;WCAA;WACA;WACA;WACA,uDAAuD,iBAAiB;WACxE;WACA,gDAAgD,aAAa;WAC7D;;;;;;;;;;;;;;;;;;;ACJO,QAAS,CAAAA,kBAAkBA,CAACC,kBAA0B,CAG3D,IAHiCA,kBAA0B,WAA1BA,kBAA0B,CAAG,EAAE,EAIhE,KAAM,CAACC,UAAU,CAAEC,UAAU,CAAC,CAAGC,oBAAoB,CAACH,kBAAkB,CAAC,CAEzE,GAAIE,UAAU,CAAE,CACd,MAAO,CACLA,UAAU,CACVE,UAAU,CAAEH,UACd,CAAC,CACH,CAEA,MAAO,CACLC,UAAU,CAAED,UACd,CAAC,CACH,CAEA;AACA,KAAM,CAAAE,oBAAoB,CAAIE,UAAkB,EAC9CA,UAAU,CAACC,KAAK,CAAC,GAAG,CAAC;;;;AEtBhB,QAAS,CAAAC,UAAUA,CACxBC,GAAW,CACXC,IAAY,CACZC,YAAoB,CACpBC,MAAc,CACd,CACA,GAAI,CAAAC,MAAW,CAAGJ,GAAG,CACrB,IAAK,KAAM,CAAAK,KAAK,GAAI,CAAAJ,IAAI,CAACH,KAAK,CAAC,GAAG,CAAC,CAAE,CACnC,GAAI,CAACM,MAAM,CAAE,CACX,MAAO,CAAAF,YAAY,CACrB,CACAE,MAAM,CAAGA,MAAM,CAACC,KAAK,CAAC,CACxB,CAEA,MAAQ,GAAED,MAAO,GAAED,MAAO,EAAC,CAC7B;;ACbA,KAAM,CAAAG,WAAW,CAAG,GAAG,CAEvB,KAAM,CAAAC,OAAO,CAAG,CAAC,SAAS,CAAE,aAAa,CAAC,CAE1C,KAAM,CAAAC,eAAe,CAAG,CAAC,gBAAgB,CAAE,uBAAuB,CAAC,CAEnE,KAAM,CAAAC,mBAAmB,CAAG,kBAAkB,CAE9C,KAAM,CAAAC,yBAAyB,CAAG,QAAQ,CAE1C,KAAM,CAAAC,qBAAqB,CAAG,GAAI,CAAAC,MAAM,CAAE,OAAML,OAAO,CAACM,IAAI,CAAC,GAAG,CAAE,IAAG,CAAC,CAEtE,KAAM,CAAAC,yBAAyB,CAAG,GAAI,CAAAF,MAAM,CACzC,OAAMJ,eAAe,CAACK,IAAI,CAAC,GAAG,CAAE,IACnC,CAAC,CAED,KAAM,CAAAE,iCAAiC,CAAG,GAAI,CAAAH,MAAM,CACjD,QAAOH,mBAAoB,GAC9B,CAAC,CAkBM,QAAS,CAAAO,UAAUA,CAACC,IAAoB,CAAE,CAC/C,KAAM,CAAAC,MAAM,CAAGC,aAAa,CAACF,IAAI,CAACG,IAAI,CAAC,CACvC,KAAM,CAAAC,QAAQ,CAAGC,uBAAuB,CAACJ,MAAM,CAAED,IAAI,CAACM,gBAAgB,CAAC,CACvE,KAAM,CAAAtB,IAAI,CAAGuB,uBAAuB,CAACP,IAAI,CAACQ,SAAS,CAAER,IAAI,CAACS,IAAI,EAAI,CAAC,CAAC,CAAC,CAErE,MAAO,CAAAC,WAAW,CAAC1B,IAAI,CAAEoB,QAAQ,CAAC,CACpC,CAEA,QAAS,CAAAG,uBAAuBA,CAACC,SAAiB,CAAEC,IAAY,CAAE,CAChE,MAAO,CAAAD,SAAS,CACb3B,KAAK,CAAC,GAAG,CAAC,CACV8B,GAAG,CAAE3B,IAAI,EAAK4B,oBAAoB,CAAC5B,IAAI,CAAEyB,IAAI,CAAC,CAAC,CAC/Cb,IAAI,CAAC,GAAG,CAAC,CACd,CAEA,QAAS,CAAAgB,oBAAoBA,CAACJ,SAAiB,CAAEC,IAAY,CAAE,CAC7D,KAAM,CAAAI,gBAAgB,CAAGL,SAAS,CAACM,KAAK,CAACrB,yBAAyB,CAAC,EAAI,EAAE,CAEzE,KAAM,CAAAL,KAAK,CAAGyB,gBAAgB,CAAC,CAAC,CAAC,CAEjC,GAAIzB,KAAK,CAAE,CACT,KAAM,CAAAF,MAAM,CAAGsB,SAAS,CAACO,OAAO,CAACF,gBAAgB,CAAC,CAAC,CAAC,CAAG,EAAE,CAAC,CAC1D,MAAO,CAAA/B,UAAU,CAAC2B,IAAI,CAAErB,KAAK,CAAEoB,SAAS,CAAEtB,MAAM,CAAC,CACnD,CAEA,MAAO,CAAAsB,SAAS,CAClB,CAEA,QAAS,CAAAN,aAAaA,CAACC,IAAY,CAAE,CACnC,KAAM,CAAAa,YAAY,CAAGC,iBAAiB,CAACd,IAAI,CAAC,CAE5C,MAAO,CAAAa,YAAY,CAChBD,OAAO,CAACrB,qBAAqB,CAAE,gBAAgB,CAAC,CAChDqB,OAAO,CAAClB,yBAAyB,CAAE,oBAAoB,CAAC,CACxDkB,OAAO,CAACjB,iCAAiC,CAAE,oBAAoB,CAAC,CACrE,CAEA;AACA,QAAS,CAAAmB,iBAAiBA,CAACd,IAAY,CAAE,CACvC;AACA,MAAO,CAAAA,IAAI,CAACY,OAAO,CAAC,oBAAoB,CAAE,oBAAoB,CAAC,CACjE,CAEA,QAAS,CAAAV,uBAAuBA,CAC9BJ,MAAc,CACdK,gBAAkC,CAClC,CACA,KAAM,CAAAF,QAAQ,CAAGE,gBAAgB,CAACL,MAAM,CAAC,EAAIK,gBAAgB,CAACjB,WAAW,CAAC,CAE1E,GAAI,CAACe,QAAQ,CAAE,CACb,GAAIc,YAAY,CAACjB,MAAM,CAAC,CAAE,CACxB;AACA;AACA;AACA,MAAO,CAAAK,gBAAgB,CAACa,aAAa,CAAC,CACxC,CACF,CAEA,MAAO,CAAAf,QAAQ,CACjB,CAEA,QAAS,CAAAM,WAAWA,CAACF,SAAiB,CAAEJ,QAAmB,CAAE,CAC3D,KAAM,CAAAgB,OAAO,CAAGhB,QAAQ,cAARA,QAAQ,CAAEiB,IAAI,CAAEC,CAAC,EAAKd,SAAS,CAACe,UAAU,CAACD,CAAC,CAACE,QAAQ,CAAC,CAAC,CAEvE,GAAI,CAACJ,OAAO,CAAE,CACZ;AACA,MAAO,CAAAZ,SAAS,CAClB,CAEA,MAAO,CAAAY,OAAO,CAACK,OAAO,CAAGjB,SAAS,CAACkB,KAAK,CAACN,OAAO,CAACI,QAAQ,CAACG,MAAM,CAAC,CACnE,CASA,QAAS,CAAAT,YAAYA,CAACjB,MAAc,CAAE,CACpC,MAAO,CAAC,CAACA,MAAM,CAACa,KAAK,CAAC,kBAAkB,CAAC,CAC3C,CAEA,KAAM,CAAAK,aAAa,CAAG,mBAAmB;;ACzHzC;AACA,QAAS,CAAAS,aAAaA,CAACnB,IAAY,CAAEzB,IAAI,CAAO,IAAXA,IAAI,WAAJA,IAAI,CAAG,EAAE,EAC5C,KAAM,CAAA6C,MAAW,CAAG,CAAC,CAAC,CAEtBC,MAAM,CAACC,OAAO,CAACtB,IAAI,CAAC,CAACuB,OAAO,CAACC,IAAA,EAAkB,IAAjB,CAACC,GAAG,CAAEC,KAAK,CAAC,CAAAF,IAAA,CACxC,KAAM,CAAAG,QAAQ,CACZD,KAAK,GAAK,IAAI,EAAI,MAAO,CAAAA,KAAK,GAAK,QAAQ,EAAI,CAACE,KAAK,CAACC,OAAO,CAACH,KAAK,CAAC,CACtE,KAAM,CAAAI,SAAS,CAAG7B,0BAAW,CAAC1B,IAAI,CAAEkD,GAAG,CAAC,CAExC,GAAIE,QAAQ,CAAE,CACZ,KAAM,CAAAI,gBAAgB,CAAGZ,aAAa,CAACO,KAAK,CAAEI,SAAS,CAAC,CACxDT,MAAM,CAACW,MAAM,CAACZ,MAAM,CAAEW,gBAAgB,CAAC,CACzC,CAAC,IAAM,CACLX,MAAM,CAACU,SAAS,CAAC,CAAGJ,KAAK,CAC3B,CACF,CAAC,CAAC,CAEF,MAAO,CAAAN,MAAM,CACf,CAEA,QAAS,CAAAnB,0BAAWA,CAAC1B,IAAY,CAAEkD,GAAW,CAAE,CAC9C,MAAQ,GAAElD,IAAK,GAAEA,IAAI,CAAG,GAAG,CAAG,EAAG,GAAEkD,GAAI,EAAC,CAC1C,CAEO,QAAS,CAAAQ,iBAAiBA,CAACb,MAAW,CAAE,CAC7C,KAAM,CAAAc,OAAO,CAAGf,aAAa,CAACC,MAAM,CAAC,CAErC,MAAO,CAAAC,MAAM,CAACC,OAAO,CAACY,OAAO,CAAC,CAACC,MAAM,CAAC,CAACC,eAAe,CAAAC,KAAA,GAAmB,IAAjB,CAACZ,GAAG,CAAEC,KAAK,CAAC,CAAAW,KAAA,CAClE;AACA,KAAM,CAAAC,SAAS,CAAGV,KAAK,CAACC,OAAO,CAACH,KAAK,CAAC,CAAGA,KAAK,CAAG,CAACA,KAAK,CAAC,CAExDY,SAAS,CAACf,OAAO,CAAEgB,KAAU,EAAK,CAChC,GAAIA,KAAK,GAAKC,SAAS,EAAID,KAAK,GAAK,IAAI,CAAE,CACzC,OACF,CAEAH,eAAe,CAACK,MAAM,CAAChB,GAAG,CAAEc,KAAK,CAAC,CACpC,CAAC,CAAC,CAEF,MAAO,CAAAH,eAAe,CACxB,CAAC,CAAE,GAAI,CAAAM,eAAe,CAAC,CAAC,CAAC,CAC3B","sources":["webpack://_wix_metro_runtime/webpack/universalModuleDefinition","webpack://_wix_metro_runtime/webpack/bootstrap","webpack://_wix_metro_runtime/webpack/runtime/define property getters","webpack://_wix_metro_runtime/webpack/runtime/hasOwnProperty shorthand","webpack://_wix_metro_runtime/webpack/runtime/make namespace object","webpack://_wix_metro_runtime/./serialization/utils.ts","webpack://_wix_metro_runtime/./serialization/index.ts","webpack://_wix_metro_runtime/./utils.ts","webpack://_wix_metro_runtime/./url-resolver.ts","webpack://_wix_metro_runtime/./flatten-params.ts","webpack://_wix_metro_runtime/./index.ts"],"sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine(\"counter\", [], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"counter\"] = factory();\n\telse\n\t\troot[\"counter\"] = factory();\n})((typeof self !== 'undefined' ? self : this), () => {\nreturn ","// The require scope\nvar __webpack_require__ = {};\n\n","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","type SchemaType = 'Array' | 'Map';\n\nexport function parseLeanSchemaRef(renderedSchemaName: string = ''): {\n  schemaName: string;\n  schemaType?: SchemaType;\n} {\n  const [typeOrName, schemaName] = getSchemaNameAndType(renderedSchemaName);\n\n  if (schemaName) {\n    return {\n      schemaName,\n      schemaType: typeOrName as SchemaType,\n    };\n  }\n\n  return {\n    schemaName: typeOrName,\n  };\n}\n\n// if there is no type, returns only the name\nconst getSchemaNameAndType = (leanSchema: string): string[] =>\n  leanSchema.split('#');\n","export * from './utils';\n","export function findByPath(\n  obj: object,\n  path: string,\n  defaultValue: string,\n  suffix: string,\n) {\n  let result: any = obj;\n  for (const field of path.split('.')) {\n    if (!result) {\n      return defaultValue;\n    }\n    result = result[field];\n  }\n\n  return `${result}${suffix}`;\n}\n","import { findByPath } from './utils';\n\nconst USER_DOMAIN = '_';\n\nconst DOMAINS = ['wix.com', 'editorx.com'];\n\nconst WIX_API_DOMAINS = ['42.wixprod.net', 'uw2-edt-1.wixprod.net'];\n\nconst DEV_WIX_CODE_DOMAIN = 'dev.wix-code.com';\n\nconst REGEX_CAPTURE_PROTO_FIELD = /{(.*)}/;\n\nconst REGEX_CAPTURE_DOMAINS = new RegExp(`\\\\.(${DOMAINS.join('|')})$`);\n\nconst REGEX_CAPTURE_API_DOMAINS = new RegExp(\n  `\\\\.(${WIX_API_DOMAINS.join('|')})$`,\n);\n\nconst REGEX_CAPTURE_DEV_WIX_CODE_DOMAIN = new RegExp(\n  `.*\\\\.${DEV_WIX_CODE_DOMAIN}$`,\n);\n\nexport type ResolveUrlOpts = {\n  // resource path as defined in proto file, including all wildcards & co.\n  protoPath: string;\n\n  // domain as defined on FP to its mappings (might be more than one)\n  // www._base_domain_ => [{ srcPath: '/_api/foo', destPath: '/api' }]\n  domainToMappings: DomainToMappings;\n\n  // actual payload attached to request, needed in order to rersolve path,\n  // in case it conatins some dynamic parameters\n  data?: object;\n\n  // request's host\n  host: string;\n};\n\nexport function resolveUrl(opts: ResolveUrlOpts) {\n  const domain = resolveDomain(opts.host);\n  const mappings = resolveMappingsByDomain(domain, opts.domainToMappings);\n  const path = injectDataIntoProtoPath(opts.protoPath, opts.data || {});\n\n  return resolvePath(path, mappings);\n}\n\nfunction injectDataIntoProtoPath(protoPath: string, data: object) {\n  return protoPath\n    .split('/')\n    .map((path) => maybeProtoPathToData(path, data))\n    .join('/');\n}\n\nfunction maybeProtoPathToData(protoPath: string, data: object) {\n  const protoRegExpMatch = protoPath.match(REGEX_CAPTURE_PROTO_FIELD) || [];\n\n  const field = protoRegExpMatch[1];\n\n  if (field) {\n    const suffix = protoPath.replace(protoRegExpMatch[0]!, '');\n    return findByPath(data, field, protoPath, suffix);\n  }\n\n  return protoPath;\n}\n\nfunction resolveDomain(host: string) {\n  const resolvedHost = fixHostExceptions(host);\n\n  return resolvedHost\n    .replace(REGEX_CAPTURE_DOMAINS, '._base_domain_')\n    .replace(REGEX_CAPTURE_API_DOMAINS, '._api_base_domain_')\n    .replace(REGEX_CAPTURE_DEV_WIX_CODE_DOMAIN, '*.dev.wix-code.com');\n}\n\n// hosts which standard string replacing doesn't apply to them, will be fixed here.\nfunction fixHostExceptions(host: string) {\n  // https://system-kb.wixanswers.com/kb/en/article/editorx-domains-matching-to-wixcom\n  return host.replace('create.editorx.com', 'editor.editorx.com');\n}\n\nfunction resolveMappingsByDomain(\n  domain: string,\n  domainToMappings: DomainToMappings,\n) {\n  const mappings = domainToMappings[domain] || domainToMappings[USER_DOMAIN];\n\n  if (!mappings) {\n    if (isBaseDomain(domain)) {\n      // fallback <lang>.wix.com sub domains to www.wix.com\n      // since all of the languages subdomain are not mapped automatically in FP and we want to support those kind of calls\n      // for example: fr.wix.com\n      return domainToMappings[wwwBaseDomain];\n    }\n  }\n\n  return mappings;\n}\n\nfunction resolvePath(protoPath: string, mappings: Mapping[]) {\n  const mapping = mappings?.find((m) => protoPath.startsWith(m.destPath));\n\n  if (!mapping) {\n    // todo: should we return the path? if no - what should we do in case of testings?\n    return protoPath;\n  }\n\n  return mapping.srcPath + protoPath.slice(mapping.destPath.length);\n}\n\ntype Mapping = {\n  srcPath: string;\n  destPath: string;\n};\n\ntype DomainToMappings = Record<string, Mapping[]>;\n\nfunction isBaseDomain(domain: string) {\n  return !!domain.match(/\\._base_domain_$/);\n}\n\nconst wwwBaseDomain = 'www._base_domain_';\n","// Flatten a nested object to params object { field: { text: 'foo' } } => { field.text ='foo' }\nfunction flattenParams(data: object, path = '') {\n  const params: any = {};\n\n  Object.entries(data).forEach(([key, value]) => {\n    const isObject =\n      value !== null && typeof value === 'object' && !Array.isArray(value);\n    const fieldPath = resolvePath(path, key);\n\n    if (isObject) {\n      const serializedObject = flattenParams(value, fieldPath);\n      Object.assign(params, serializedObject);\n    } else {\n      params[fieldPath] = value;\n    }\n  });\n\n  return params;\n}\n\nfunction resolvePath(path: string, key: string) {\n  return `${path}${path ? '.' : ''}${key}`;\n}\n\nexport function toURLSearchParams(params: any) {\n  const flatten = flattenParams(params);\n\n  return Object.entries(flatten).reduce((urlSearchParams, [key, value]) => {\n    // inorder to make `foo: [1,2]` turn into `foo=1&foo=2` and not `foo[]=1&foo[]=2`\n    const keyParams = Array.isArray(value) ? value : [value];\n\n    keyParams.forEach((param: any) => {\n      if (param === undefined || param === null) {\n        return;\n      }\n\n      urlSearchParams.append(key, param);\n    });\n\n    return urlSearchParams;\n  }, new URLSearchParams());\n}\n","export * from './serialization';\nexport * from './url-resolver';\nexport * from './flatten-params';\n"],"names":["parseLeanSchemaRef","renderedSchemaName","typeOrName","schemaName","getSchemaNameAndType","schemaType","leanSchema","split","findByPath","obj","path","defaultValue","suffix","result","field","USER_DOMAIN","DOMAINS","WIX_API_DOMAINS","DEV_WIX_CODE_DOMAIN","REGEX_CAPTURE_PROTO_FIELD","REGEX_CAPTURE_DOMAINS","RegExp","join","REGEX_CAPTURE_API_DOMAINS","REGEX_CAPTURE_DEV_WIX_CODE_DOMAIN","resolveUrl","opts","domain","resolveDomain","host","mappings","resolveMappingsByDomain","domainToMappings","injectDataIntoProtoPath","protoPath","data","resolvePath","map","maybeProtoPathToData","protoRegExpMatch","match","replace","resolvedHost","fixHostExceptions","isBaseDomain","wwwBaseDomain","mapping","find","m","startsWith","destPath","srcPath","slice","length","flattenParams","params","Object","entries","forEach","_ref","key","value","isObject","Array","isArray","fieldPath","serializedObject","assign","toURLSearchParams","flatten","reduce","urlSearchParams","_ref2","keyParams","param","undefined","append","URLSearchParams"],"sourceRoot":""}